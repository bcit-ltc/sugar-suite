@use "../../variables/breakpoints" as *;
@use "../../variables/colors" as *;
@use "../../variables/fonts" as *;
@use "../../partials/actions/button";
@use "../../partials/containers/custom-max-width";

.flashcard-container {
    @extend %custom-max-width;
    perspective: 1000px;
    position: relative;
    pointer-events: none;
    padding-top: 350px;
    clear: both;
    top: -350px;
    margin-bottom: 2em;
    width: auto;
    margin-left: 0;
    margin-right: 0;
    min-height: 500px;

    .card-stack {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 200px;
        // max-height: 60vh;
        height: auto;
        width: 100%;
        max-width: 100%;
        margin: 2em 0.5em 2em;
        outline: none;

        &:focus {
            box-shadow: 1px 1px 75px $bcit-fraser;
        }

        .card {
            position: absolute;
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            min-height: 200px;
            // max-height: 60vh;
            line-height: 1.5;
            perspective: 1000px;
            transform-style: preserve-3d;
            backface-visibility: hidden;

            img {
                display: block;
                margin: 0;
                height: auto;
                max-width: calc(100% - 1em); // Account for the added margins
                max-height: 55vh;
                object-fit: contain;
                flex-shrink: 0;
                flex-grow: 0;
                pointer-events: none;
            }


            .front,
            .back {
                perspective: 1000px;
                transition: transform .5s;
                box-shadow: 1px 2px 5px rgba(0, 0, 0, .3), inset 0 0 300px rgba(25, 28, 65, 0.05);
                backface-visibility: hidden;
                position: absolute;
                top: 0;
                left: 0;
                min-height: 200px;
                max-height: 60vh;
                /* height will be set by JS */
                width: 100%;
                margin-right: -150px;
                padding: 20px 15px 20px 15px;
                display: flex;
                flex-direction: column;
                justify-content: flex-start; // Start from top instead of center
                align-items: stretch; // Stretch content to full width
                flex: 1 1 auto;
                box-sizing: border-box; // Include padding in height calculations

                >* {
                    margin-bottom: 0.3em;
                }

                img {
                    display: block;
                    height: auto;
                    max-width: 100%;
                    max-height: calc(100% - 2em); // Leave room for text content
                    object-fit: contain;
                    flex-shrink: 0;
                    flex-grow: 0;
                    pointer-events: none;
                }

            }


            .front {
                z-index: 2;
                background: $white;
                transform: rotateY(0deg);
                pointer-events: auto;

                // Add example styles to visually differentiate front and back using data-side attributes.
                &[data-side="front"] {
                    border-top: 0.4em solid $bcit-pacific; // Blue accent for front
                }
            }

            .back {
                background: $off-white;
                transform: rotateY(-180deg);

                &[data-side="back"] {
                    border-top: 0.4em solid $bcit-moss; // Maroon accent for back
                }
            }

            .front:before,
            .back:before {
                content: "";
                display: inline-block;
                height: 0;
                vertical-align: middle;
            }


            &.top-card {
                z-index: 1001;
                transition: transform .5s ease; // messes up firefox
                transform: none !important;

                &.flipped {
                    .front {
                        pointer-events: none;
                    }

                    .back {
                        pointer-events: auto;
                    }
                }
            }




            // Center content if only one child in .front or .back
            .centered {
                display: inline-block;
                vertical-align: middle;
            }
        }

    }

    // Default single-child centering (only when no data attributes are present)
    &:not([data-justify-content]):not([data-align-items]) {
        .card {
            .front,
            .back {
                &:has(> *:only-child) {
                    justify-content: center;

                    &>* {
                        text-align: center;
                    }
                }
            }
        }
    }

    // Image constraints for all data attributes
    &[data-justify-content],
    &[data-align-items] {
        .card {
            .front,
            .back {
                img {
                    max-width: 100% !important;
                    max-height: 100% !important;
                    object-fit: contain !important;
                }
            }
        }
    }

    // Specific image alignment for different align-items values
    &[data-align-items="flex-start"] {
        .card {
            .front,
            .back {
                img {
                    align-self: flex-start !important;
                }
            }
        }
    }

    &[data-align-items="center"] {
        .card {
            .front,
            .back {
                img {
                    align-self: center !important;
                }
            }
        }
    }

    &[data-align-items="flex-end"] {
        .card {
            .front,
            .back {
                img {
                    align-self: flex-end !important;
                }
            }
        }
    }

    // Justify-content override when data-justify-content is specified
    &[data-justify-content="flex-start"] {
        .card {
            .front,
            .back {
                justify-content: flex-start !important;
                align-items: flex-start !important;
                
                // Override single-child centering with higher specificity
                &:has(> *:only-child) {
                    justify-content: flex-start !important;
                    
                    &>* {
                        text-align: left !important;
                    }
                }
            }
        }
    }

    &[data-justify-content="center"] {
        .card {
            .front,
            .back {
                justify-content: center !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    justify-content: center !important;
                    
                    &>* {
                        text-align: center !important;
                    }
                }
            }
        }
    }

    &[data-justify-content="flex-end"] {
        .card {
            .front,
            .back {
                justify-content: flex-end !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    justify-content: flex-end !important;
                    
                    &>* {
                        text-align: right !important;
                    }
                }
            }
        }
    }

    &[data-justify-content="space-between"] {
        .card {
            .front,
            .back {
                justify-content: space-between !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    justify-content: space-between !important;
                    
                    &>* {
                        text-align: left !important;
                    }
                }
            }
        }
    }

    &[data-justify-content="space-around"] {
        .card {
            .front,
            .back {
                justify-content: space-around !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    justify-content: space-around !important;
                    
                    &>* {
                        text-align: center !important;
                    }
                }
            }
        }
    }

    &[data-justify-content="space-evenly"] {
        .card {
            .front,
            .back {
                justify-content: space-evenly !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    justify-content: space-evenly !important;
                    
                    &>* {
                        text-align: center !important;
                    }
                }
            }
        }
    }

    // Align-items override when data-align-items is specified
    &[data-align-items="stretch"] {
        .card {
            .front,
            .back {
                align-items: stretch !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    align-items: stretch !important;
                }
            }
        }
    }

    &[data-align-items="flex-start"] {
        .card {
            .front,
            .back {
                align-items: flex-start !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    align-items: flex-start !important;
                }
            }
        }
    }

    &[data-align-items="center"] {
        .card {
            .front,
            .back {
                align-items: center !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    align-items: center !important;
                }
            }
        }
    }

    &[data-align-items="flex-end"] {
        .card {
            .front,
            .back {
                align-items: flex-end !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    align-items: flex-end !important;
                }
            }
        }
    }

    &[data-align-items="baseline"] {
        .card {
            .front,
            .back {
                align-items: baseline !important;
                
                // Override single-child centering
                &:has(> *:only-child) {
                    align-items: baseline !important;
                }
            }
        }
    }

    // Per-card alignment classes
    .card {
        &.justify-content-flex-end {
            .front,
            .back {
                justify-content: flex-end !important;
                
                &:has(> *:only-child) {
                    justify-content: flex-end !important;
                    
                    &>* {
                        text-align: right !important;
                    }
                }
            }
        }

        &.align-items-flex-end {
            .front,
            .back {
                align-items: flex-end !important;
                
                &:has(> *:only-child) {
                    align-items: flex-end !important;
                }
            }
        }

        &.justify-content-center {
            .front,
            .back {
                justify-content: center !important;
                
                &:has(> *:only-child) {
                    justify-content: center !important;
                    
                    &>* {
                        text-align: center !important;
                    }
                }
            }
        }

        &.align-items-center {
            .front,
            .back {
                align-items: center !important;
                
                &:has(> *:only-child) {
                    align-items: center !important;
                }
            }
        }


        // Override table-level data attributes when per-card classes are present
        &.top-left,
        &.top-center,
        &.top-right,
        &.middle-left,
        &.middle-center,
        &.middle-right,
        &.bottom-left,
        &.bottom-center,
        &.bottom-right {
            .front,
            .back {
                // Override any table-level justify-content
                justify-content: initial !important;
                align-items: initial !important;
                
                // Override any table-level image constraints
                img {
                    align-self: initial !important;
                    margin: initial !important;
                }
            }
        }

        // 9-direction positioning classes using absolute positioning
        &.top-left {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    top: 0 !important;
                    left: 0 !important;
                    text-align: left !important;
                    max-width: 100% !important;
                    transform: none !important;
                }
                
                img {
                    position: absolute !important;
                    top: 0 !important;
                    left: 0 !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                    transform: none !important;
                }
            }
        }

        &.top-center {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    top: 0 !important;
                    left: 50% !important;
                    transform: translateX(-50%) !important;
                    text-align: center !important;
                    max-width: 100% !important;
                }
                
                img {
                    position: absolute !important;
                    top: 0 !important;
                    left: 50% !important;
                    transform: translateX(-50%) !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                }
            }
        }

        &.top-right {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    top: 0 !important;
                    right: 0 !important;
                    text-align: right !important;
                    max-width: 100% !important;
                    transform: none !important;
                }
                
                img {
                    position: absolute !important;
                    top: 0 !important;
                    right: 0 !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                    transform: none !important;
                }
            }
        }

        &.middle-left {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    top: 50% !important;
                    left: 0 !important;
                    transform: translateY(-50%) !important;
                    text-align: left !important;
                    max-width: 100% !important;
                }
                
                img {
                    position: absolute !important;
                    top: 50% !important;
                    left: 0 !important;
                    transform: translateY(-50%) !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                }
            }
        }

        &.middle-center {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    top: 50% !important;
                    left: 50% !important;
                    transform: translate(-50%, -50%) !important;
                    text-align: center !important;
                    max-width: 100% !important;
                }
                
                img {
                    position: absolute !important;
                    top: 50% !important;
                    left: 50% !important;
                    transform: translate(-50%, -50%) !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                }
            }
        }

        &.middle-right {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    top: 50% !important;
                    right: 0 !important;
                    transform: translateY(-50%) !important;
                    text-align: right !important;
                    max-width: 100% !important;
                }
                
                img {
                    position: absolute !important;
                    top: 50% !important;
                    right: 0 !important;
                    transform: translateY(-50%) !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                }
            }
        }

        &.bottom-left {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    bottom: 0 !important;
                    left: 0 !important;
                    text-align: left !important;
                    max-width: 100% !important;
                    transform: none !important;
                }
                
                img {
                    position: absolute !important;
                    bottom: 0 !important;
                    left: 0 !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                    transform: none !important;
                }
            }
        }

        &.bottom-center {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    bottom: 0 !important;
                    left: 50% !important;
                    transform: translateX(-50%) !important;
                    text-align: center !important;
                    max-width: 100% !important;
                }
                
                img {
                    position: absolute !important;
                    bottom: 0 !important;
                    left: 50% !important;
                    transform: translateX(-50%) !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                }
            }
        }

        &.bottom-right {
            .front,
            .back {
                &>* {
                    position: absolute !important;
                    bottom: 0 !important;
                    right: 0 !important;
                    text-align: right !important;
                    max-width: 100% !important;
                    transform: none !important;
                }
                
                img {
                    position: absolute !important;
                    bottom: 0 !important;
                    right: 0 !important;
                    max-width: 100% !important;
                    width: auto !important;
                    height: auto !important;
                    transform: none !important;
                }
            }
        }
    }

    // Allows the element following to sit against it
    +* {
        margin-top: -350px;
    }


    // hide card counter if .no-number is present on container
    // hide navigation controls if .no-nav is present on container
    &.no-number .card-counter,
    &.no-nav .card-controls {
        display: none !important;
    }


    // Control Buttons
    .card-controls {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        gap: 0.5em;
        width: auto;
        margin: 0.5em auto;
        padding: 0;
        flex-wrap: nowrap;

        // BUTTONS
        button {
            pointer-events: all;
            @extend .btn;
            display: inline-block;
            margin: 0; // Remove all margin
            font-size: 0; // Hide text visually, but keep for screen readers
            letter-spacing: 0;
            padding: 3px;
            width: 30px;
            height: 30px;
            transition: background 0.2s, box-shadow 0.2s, border-color 0.2s;
            position: relative; // For tooltip positioning

            &:before {
                text-align: center;
                font-family: FontAwesome;
                font-weight: normal;
                font-style: normal;
                display: inline-block;
                text-rendering: auto;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                font-size: 16px; // Explicitly set font size for icons
                line-height: 1;
            }

            &.next:before {
                content: "\f061"; // fa-arrow-right
            }

            &.prev:before {
                content: "\f060"; // fa-arrow-left
            }

            &.flip:before {
                content: "\f021"; // fa-refresh
            }

            &.view-table:before {
                content: "\f0ce"; // fa-table
            }

            &.flip-all:before {
                content: "\f07e"; // fa-arrows-h (horizontal arrows representing flip all)
            }

            &.reset:before {
                content: "\f1da"; // fa-history (clock with arrow representing reset/restore)
            }

            &.shuffle:before {
                content: "\f074"; // fa-random
            }

            // Visually hidden text for accessibility (screen readers)
            .visually-hidden {
                position: absolute !important;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            // Focus indicator for accessibility
            &:focus {
                outline: 2px solid $bcit-moss;
                outline-offset: 2px;
                box-shadow: 0 0 0 3px $bcit-driftwood;
            }

            // Click feedback
            &:active,
            &.active {
                background: $primary-color; // Dark blue background
                box-shadow: 0 0 0 3px $primary-color-dark; // Darker blue shadow
                border-color: $primary-color;
            }

            // Tooltip styles - only show when content exists
            &:hover::after,
            &:focus::after {
                content: attr(data-tooltip);
                position: absolute;
                bottom: 100%;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 6px 10px;
                border-radius: 4px;
                font-size: 12px;
                font-family: $primary-font;
                white-space: nowrap;
                z-index: 1000;
                pointer-events: none;
                margin-bottom: 5px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
                opacity: 0;
                animation: tooltipFadeIn 0.2s ease-out 0.1s forwards;
                
                // Only show tooltip if it has content
                &:not([data-tooltip=""]) {
                    display: block;
                }
                
                // Tooltip arrow
                &::before {
                    content: '';
                    position: absolute;
                    top: 100%;
                    left: 50%;
                    transform: translateX(-50%);
                    border: 4px solid transparent;
                    border-top-color: rgba(0, 0, 0, 0.9);
                }
            }

            // Hide tooltip when not hovering/focused
            &:not(:hover):not(:focus)::after {
                content: none;
            }
        }
    }

}



/* DO NOT MOVE THIS. It breaks the flashcard flip animation. Animation used in conjunction with transition on .card */
.flashcard-container .card-stack .flipped {
    .front {
        transform: rotateY(180deg) !important;
    }

    .back {
        transform: rotateY(0deg) !important;
    }

}


// Hide scroll bars during animations
.flashcard-animating {
    // Hide horizontal scroll bar during animations
    overflow-x: hidden !important;
    
    // Also hide any scroll-to-top buttons during animations
    .scroll-to-top,
    .scroll-top,
    .back-to-top,
    [class*="scroll"],
    [id*="scroll"] {
        display: none !important;
    }
}

// Next Card Animation
.flashcards-swap-next {
    transform-origin: 165% 158%;
    animation: flashcardsSwapNext .9s;
    animation-timing-function: ease-in-out;
    transition-property: none;
}

// Prev Card Animation
.flashcards-swap-prev {
    transform-origin: 165% 158%;
    animation: flashcardsSwapPrev .9s;
    animation-timing-function: ease-in-out;
    transition-property: none;
}

// ANIMATIONS
@keyframes flashcardsSwapNext {
    0% {
        transform: rotateZ(0deg);
    }

    50% {
        transform: rotateZ(45deg);
    }

    99% {
        transform: rotateZ(1deg);
    }

    100% {
        transform: rotateZ(0deg);
    }
}

@keyframes flashcardsSwapPrev {
    0% {
        transform: rotateZ(0deg) translateX(0%);
    }

    50% {
        transform: rotateZ(0deg) translateX(110%);
    }

    100% {
        transform: rotateZ(0deg) translateX(0%);
    }
}

//Working shuffle animation
.animation {
    animation: shuffle1 1.1s;

    :first-child {
        animation: shuffle2 1.1s;
    }

    :nth-child(2) {
        animation: shuffle3 1.1s;
    }

    :nth-child(3) {
        animation: shuffle4 1.1s;
    }
}


@keyframes shuffle1 {
    0% {
        top: 0px;
    }

    25% {
        top: -50px;
        transform: rotate(-45deg)translate(-20px, -10px);
        z-index: 1000;
    }

    50% {
        top: 50px;
        transform: translate(0px, -10px);
        z-index: 1002;
    }

    75% {
        top: -50px;
        transform: rotate(45deg)translate(50px, -10px);
        z-index: 1001;
    }

    100% {
        top: 0px;
        z-index: 999;
    }

}


@keyframes shuffle2 {
    0% {
        top: 0px;
    }

    25% {
        top: 50px;
        transform: rotate(45deg) translate(-50px, -10px);
        z-index: 1002;
    }

    50% {
        top: -50px;
        transform: translate(50px, -10px);
        z-index: 1001;
    }

    75% {
        top: 50px;
        transform: rotate(-45deg) translate(-50px, -10px);
        z-index: 1002;
    }

    100% {
        top: 0px;
        z-index: 1000;
    }

}

@keyframes shuffle3 {
    0% {
        top: 0px;
    }

    25% {
        top: 50px;
        transform: rotate(-45deg) translate(50px, -10px);
        z-index: 999;
    }

    50% {
        top: -50px;
        transform: translate(-50px, -10px);
        z-index: 1001;
    }

    75% {
        top: 50px;
        transform: rotate(45deg) translate(50px, -10px);
        z-index: 1000;
    }

    100% {
        top: 0px;
        z-index: 1002;
    }

}

@keyframes shuffle4 {
    0% {
        top: 0px;
    }

    25% {
        top: -50px;
        transform: rotate(45deg)translate(-50px, -10px);
        z-index: 1000;
    }

    50% {
        top: 50px;
        transform: translate(0px, -10px);
        z-index: 1001;
    }

    75% {
        top: -50px;
        transform: rotate(-45deg)translate(-50px, -10px);
        z-index: 1002;
    }

    100% {
        top: 0px;
        z-index: 1001;
    }

}

// Tooltip animations
@keyframes tooltipFadeIn {
    0% {
        opacity: 0;
        transform: translateX(-50%) translateY(5px);
    }
    100% {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

@keyframes tooltipFadeOut {
    0% {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
    100% {
        opacity: 0;
        transform: translateX(-50%) translateY(5px);
    }
}